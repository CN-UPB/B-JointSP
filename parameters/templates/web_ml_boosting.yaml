# example chain template: User -> LB (HAProxy) -> Cache (Squid) -> Web (Nginx)
# all VNFs use ML models to predict their CPU requirements
name: web_ml
vnfs:
  - name: vnf_user
    type: source
    stateful: True
    inputs_fwd: 0
    inputs_bwd: 0
    outputs_fwd: 1
    outputs_bwd: 0
    cpu: [1]
    mem: [1]
    vnf_delay: 0
    out_fwd: []
    out_bwd: []
  - name: vnf_lb
    type: normal
    stateful: False
    inputs_fwd: 1
    inputs_bwd: 0
    outputs_fwd: 1
    outputs_bwd: 0
    # new optional field, specifying the ML model for predicting resource requirements
    # replaces the cpu and mem coefficients specified below (still required)
    # path specified relative to from where bjointsp is executed
    ml_model_path: "parameters/ml/web2_small/GradientBoostingRegressor.joblib"
    cpu: [1,0]
    mem: [1,0]
    vnf_delay: 10
    out_fwd:
      - [1,0]
    out_bwd: []
  - name: vnf_cache
    type: normal
    stateful: False
    inputs_fwd: 1
    inputs_bwd: 0
    outputs_fwd: 1
    outputs_bwd: 0
    ml_model_path: "parameters/ml/web3_small/GradientBoostingRegressor.joblib"
    cpu: [1,0]
    mem: [1,0]
    vnf_delay: 10
    out_fwd:
      - [1,0]
    out_bwd: []
  - name: vnf_web
    type: normal
    stateful: False
    inputs_fwd: 1
    inputs_bwd: 0
    outputs_fwd: 0
    outputs_bwd: 0
    ml_model_path: "parameters/ml/web1_small/GradientBoostingRegressor.joblib"
    cpu: [1,0]
    mem: [1,0]
    vnf_delay: 10
    out_fwd: []
    out_bwd: []
vlinks:
  - direction: forward
    src: vnf_user
    src_output: 0
    dest: vnf_lb
    dest_input: 0
    max_delay: 50
  - direction: forward
    src: vnf_lb
    src_output: 0
    dest: vnf_cache
    dest_input: 0
    max_delay: 50
  - direction: forward
    src: vnf_cache
    src_output: 0
    dest: vnf_web
    dest_input: 0
    max_delay: 50
